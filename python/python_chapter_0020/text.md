# Глава 2. Структура кода, объявление переменных

В этой главе мы рассмотрим структуру программы, некоторые синтаксические правила и исключения из этих правил, способы объявления переменных. Кроме того, вы узнаете, для чего нужны объект-синглтон «многоточие» и оператор моржа.

## Структура программы
В C# точкой входа в приложение является метод `Main()`. В Java и go — `main()`. Эти и многие другие языки объединяет нерушимое правило: нельзя просто написать код на уровне файла и запустить его. Питон — представитель скриптовых языков, и на него это правило не распространяется: с первой же строчки скрипта может начинаться бизнес-логика, не обернутая ни в какую функцию.

Исходный код программы на питоне принято сохранять в файлах с расширением `.py`. Для запуска из консоли необходимо вызвать интерпретатор питона и первым аргументом указать имя файла. Допустим, исходный код в `example.py` состоит из одной строчки:
```python
print("Dummy script, does nothing")
```

Тогда после запуска скрипта мы увидим в консоли ожидаемый вывод:
```shell
$ python example.py
Dummy script, does nothing
```

В этом коротком примере вся программа сводится к вызову функции вывода текста. В ней нет подключения модулей, объявления переменных, классов, функций. Что ж, усложним код. 

Пусть в консоль печатается текущее время:
```python
from datetime import datetime

def print_time():
    now = datetime.now()
    current_time = now.strftime("%H:%M:%S")
    print("Current Time:", current_time)

print_time()
```

На первой строке из модуля `datetime` импортируется одноименный объект в глобальное пространство имен программы. Затем объявляется функция `print_time()`. Внутри нее у объекта `datetime` вызывается метод `now()` для получения текущего времени; оно преобразовывается в удобный формат и печатается в консоль. На последней строке объявленная функция `print_time()` вызывается.

Пример демонстрирует общепринятую практику по **структурированию кода:** в начале файла импортируются нужные модули, затем объявляются какие-то глобальные переменные, функции и другие полезности, а в самом конце все это используется.

## Синтаксические правила
С этих правил начинают свой путь все питонисты.

**Вложенные блоки кода** отделяются отступами, а не фигурными скобками. Мы будем придерживаться [рекомендации из PEP8:](https://peps.python.org/pep-0008/#indentation) 1 отступ = 4 пробела. 
Вложенному блоку предшествует инструкция, заканчивающаяся двоеточием. Перед телом цикла — это условие цикла. Перед телом `if` — условие `if`. И так далее.

Пример условия:
```python
if user_is_active:
    get_next_command()
else:
    close_session()
```

Пример цикла:
```python
for item in items:
    process(item)
```

Пример функции:
```python
def is_long(s):
    if len(s) > 79:
        return "string is too long"
    return "string has normal length"
```

Конец строки — это конец инструкции. Точка с запятой в конце не ставится.

Пример с последовательным вызовом двух пользовательских функций. Никаких точек с запятой:
```python
check_db_is_online()
start_transaction()
```

Инициализируйте две переменные:{.task_text}
- `a`, равную 8, на одной строке.
- `b`, равную 10, на другой.
```python {.task_source #python_chapter_0020_task_0010}
```
```python {.task_hint}
Синтаксис: переменная = значение
```

Исправьте синтаксические ошибки в коде:{.task_text}
```python  {.task_source #python_chapter_0020_task_0020}
for i in range(1, 10); print(i);
```
```python {.task_hint}
Нужно удалить точку с запятой и перенести вызов print() на новую строку с отступом.
```

Если инструкция не влезает в строку (например, становится длиннее рекомендованных PEP8 79 символов), ее можно разбить на несколько строк с использованием круглых скобок. 
Было:
```python
while retries_count < max_retries and service_is_up and not cancelled:
    send_request()
```

Стало:
```python
while (retries_count < max_retries and 
       service_is_up and not cancelled):
    send_request()
```

Разбейте условие `if` на две строки:{.task_text}
```python  {.task_source #python_chapter_0020_task_0030}
MAX_SESSIONS = 5
MAX_QUEUE_LEN = 100

sessions_count = 9
queue_tasks = ["task1", "task2"] # Here we create list of strings

if sessions_count > MAX_SESSIONS or len(queue_tasks) > MAX_QUEUE_LEN:
    print("Error handling request")
```
```python {.task_hint}
Не забудьте обернуть условие в круглые скобки.
```

## Исключения из правил
Из этих несложных правил есть и исключения. Но их лучше избегать, чтобы не снижать читаемость кода. Тем не менее, вы можете натолкнуться на злоупотребление ими в чужом коде.

Например, несколько простых инструкций в одной строке не являются ошибкой. Друг от друга они отделяются точкой с запятой. В этом примере переменным `x` и `y` присваиваются результаты пользовательских функций:
```python
x = x_offset(); y = y_offset(); print(x, y)
```

Сделайте этот код более читабельным. Одна строка — одна инструкция: {.task_text}
```python  {.task_source #python_chapter_0020_task_0040}
x = 5; y = 8; print(x, y)
```
```python {.task_hint}
Должно получиться 3 строки: 2 для инициализации переменных и 1 на вызов функции.
```

Также допустимо размещать инструкцию и ее вложенный блок на одной строке. Это сработает, если вложенный блок не содержит каких-то своих вложенных инструкций:
```python
while is_acitve: send_request()
```

Перепишите этот код, чтобы вложенный блок `while` шел на отдельной строке: {.task_text}
```python  {.task_source #python_chapter_0020_task_0050}
def send_request():
    # some business logic
    return False

is_active = True

while is_active: is_active = send_request()
```
```python {.task_hint}
Тело цикла должно идти на отдельной строке с отступом.
```

## Оператор pass
Бывают случаи, когда вложенный блок требуется оставить пустым. Например, ловить исключение, но не совершать дополнительных действий для его обработки:
```python
try:
    send_request(data)
except Exception:
    # Do nothing
```
Но пустой вложенный блок — это синтаксическая ошибка:
```
SyntaxError: unexpected EOF while parsing
```

Чтобы ее избежать, был придуман оператор `pass`. `pass` — это [ассемблеровский NOP](https://en.wikipedia.org/wiki/NOP_(code)) в мире питона. Так сказать оператор «отсутствие оператора». 

Теперь синтаксической ошибки не будет:
```python
try:
    send_request(data)
except Exception:
    pass
```

Добавьте `pass` в цикл, чтобы устранить ошибку интерпретатора:{.task_text}
```python {.task_source #python_chapter_0020_task_0060}
n = 101

while n < 100:
```
```python {.task_hint}
```

## Многоточие
В питоне существует объект-синглтон «многоточие», привязанный к константе с именем `Ellipsis` и литералу `...`:
```python
print(Ellipsis)
print(...)
```
```
Ellipsis
Ellipsis
```

У многоточия несколько вариантов использования, и наиболее распространенный — это проставление вместо ключевого слова `pass`. Об остальных применениях (расширенный синтаксис срезов, аннотации типов и т.д.) мы поговорим в следующих главах.
```python
def handle_request(req):
    ...
```

При этом многоточие не является семантической заменой `pass`: `pass` принято проставлять в качестве индикатора намеренного отсутствия кода, а многоточие — как напоминание TBD (to be defined) при активной разработке. Например, если соответствующий блок кода планируется добавить в следующем реквесте.

## Объявление переменных
При объявлении переменной тип не указывается:
```python
height = 1.78
```

Но бывают случаи, когда нужно завести переменную и инициализировать значением по умолчанию. Для этого после оператора присвоения вызывается конструктор типа:
```python
height = float()
print(height)
```

В данном примере `height` будет равен 0.0. Это дефолтное значение для `float`. Дефолтными значениями для целого, булевой переменной и какого-либо контейнера будут соответственно 0, `False` и пустой контейнер.
Явный вызов конструктора используется редко. Но если к нему прибегают, то чаще всего не для простых типов данных, а для контейнеров: списков (list), словарей (dict) и множеств (set). Например, так выглядит заведение пустого множества: `users = set()`.


А как быть с **константами?** В питоне их нет! Вместо констант — [распространенное соглашение](https://peps.python.org/pep-0008/#constants) код-стайла: переменные, предназначенные только для чтения, именовать заглавными буквами:
```python
HEIGHT = 1.78
WIDTH = 0.5
```

Чисто технически ничто не остановит программиста от модификации такой переменной. Сохраняйте бдительность!

Заведите константу `API_URL`, равную строке `"https://api.senjun.dev.ru"`: {.task_text}
```python  {.task_source #python_chapter_0020_task_0070}
```
```python {.task_hint}
API_URL = "https://api.senjun.dev.ru"
```

## Оператор моржа
Оператор моржа (walrus) — неофициальное название для присваивания значения переменной в выражении. Оператор имеет вид морды отдыхающего на боку моржа `:=` и отличается от классического оператора `=` тем, что не только присваивает значение, но и возвращает его. За счет эффекта «два в одном» он делает код более лаконичным, а в каких-то случаях позволяет его ускорить.

Рассмотрим пример:

```python
res = calc_next_val()

while res >= 0:
    print("Next iteration of calculation...", res)
    res = calc_next_val()
```

Переменной `res` на строке 1, а затем и в цикле `while` присваивается результат, который возвращает функция `calc_next_val()`. Если заменить присваивание на оператор моржа, мы избавимся от дублирования вызова функции `calc_next_val()` и сократим код:
```python
while (res := calc_next_val()) >= 0:
    print("Next iteration of calculation...", res)
```

Перепишите условие с использованием оператора моржа.  {.task_text}

```python {.task_source #python_chapter_0020_task_0080}
title = "The walrus operator"
words_count = len(title.split())

if words_count > 10:
    print("Too many words in paragraph title:", words_count)
else:
    print("Paragraph title is suitable. Words count:", words_count)

```
```python {.task_hint}
if (words_count := len(title.split())) > 10
```

## Резюмируем
- Блоки кода определяются двоеточием и отступами.
- Для обозначения отсутствия операции во вложенном блоке предусмотрен оператор `pass`.
- Объект-синглтон `Ellipsis` и соответствующий ему литерал `...` имеют несколько вариантов использования. Самый частый — проставление многоточия `...` вместо `pass` для маркировки мест, где кода еще нет, но планируется его дописать.
- Варианты объявления переменной: `x = 0`, `x = int()`.
- Оператор моржа `:=` совмещает присвоение значения переменной с возвратом этого значения. Позволяет сократить объем кода и в отдельных случаях оптимизировать работу программы.
- Констант в питоне нет. Но есть джентльменское соглашение именовать предназначенные только для чтения переменные заглавными буквами: `TARGET_PATH="/tmp/data"`.
