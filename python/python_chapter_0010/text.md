# Глава 1. Ключевые факты
> Прост, как свинья, а лукав, как змея.  
Народная пословица

Глава посвящается ключевым фактам о питоне. Их хватит, чтобы сложить о языке первое представление, узнать его яркие особенности и изящно поддержать светскую беседу.

## Что такое питон
Питон — это интерпретируемый язык. Поддерживает объектно-ориентированную и функциональную парадигмы программирования. **Управление памятью** в питоне реализуется через подсчет ссылок и сборщик мусора. 

Типизация в питоне неявная, динамическая, строгая. Что это значит? 

**Неявная типизация.** При объявлении переменной не нужно указывать ее тип:
```python
code_ok = 200
response_ok = "OK"
```

{.paragraph}

Объявите переменную `err_service_unavailable`, равную 503: {.task_text}
```python {.task_source #python_chapter_0010_task_0010}
```
```python {.task_hint}
err_service_unavailable = 503
```

{.paragraph}

**Динамическая типизация.** По мере выполнения кода одна и та же переменная может содержать значения разных типов, от строки до числа или флага.
```python
res = True
res = "Success"
res = -1
```

А все потому, что абсолютно любая переменная в питоне — всего лишь ссылка на объект в памяти. В любой момент времени ее можно переназначить.
{.paragraph}

Ошибки типов (вроде обращения к несуществующему полю объекта) выявляются в рантайме. Допустим, мы хотим взять элемент по индексу 2 у числа. Как будто это не число, а массив:
```python
x = 10
print(x[2])
```
Скрипт запустится, но завершится с ошибкой:
```
TypeError: 'int' object is not subscriptable
```

{.paragraph}

**Строгая типизация.** Казалось бы, какая тут строгость, если одной и той же переменной невозбранно присваиваются значения разных типов. Речь о том, что в питоне нет неявного приведения типов. И этим он отличается от языков со слабой типизацией — JavaScript, PHP и других. Если попытаться сложить строку и число:
```python
print("Returned HTTP code " + 200)
```
То скрипт упадет с ошибкой интерпретатора о несовпадении типов:
```
TypeError: must be str, not int
```

{.paragraph}

Исправьте этот пример, явно приведя число к строке встроенной функцией `str()`: {.task_text}
```python {.task_source #python_chapter_0010_task_0020}
print("Returned HTTP code " + 200)
```
```python {.task_hint}
print("Returned HTTP code " + str(200))
```

{.paragraph}

## Любимые грабли начинающих питонистов
Как, не зная синтаксис, догадаться, что исходник написан на питоне? Все просто: для обозначения вложенных блоков кода питон использует пробелы либо табы. 

Вместо фигурных скобочек как в Go, JavaScript и других популярных языках в питоне верхнеуровневое выражение заканчивается **двоеточием,** а дальше в коде появляется отступ. Сравните скверно отформатированный, но рабочий код на C++:
```c++
while (true) {
bool ok = match_query(query);
if (ok)
break;
}
```

...с тем же кодом, но на питоне:
```python
while True:
    ok = match_query(query)
    if ok:
        break
```

{.paragraph}

Да, отступы в питоне — это неотъемлемая часть синтаксиса. Это не пожелание кодстайла для упрощения восприятия кода. Если забыть расставить отступы, интерпретатор вернет ошибку:
```
IndentationError: expected an indented block
```

В качестве отступов можно использовать как пробелы, так и табы. Главное — выбрать что-то одно и не смешивать, иначе получите уже другую ошибку:
```
TabError: inconsistent use of tabs and spaces in indentation
```

Отсутствие пробелов и их смешивание с табами — **лидеры рейтинга ошибок** начинающих питонистов. Чтобы на этом не попадаться, нужна практика.

{.paragraph}

Исправьте ошибки в коде: {.task_text}
```python {.task_source #python_chapter_0010_task_0030}
new_items = [2, 8, 6]
for item in new_items
print(item)
```
```python {.task_hint}
Функция print() должна вызываться внутри цикла с новой строки. Перед ней нужно поставить отступ (например, 4 пробела).
```

{.paragraph}

В этом коде допущено несколько ошибок. Например, табы смешаны с пробелами. Почините код, расставив отступы заново с использованием пробелов и исправив другие синтаксические ошибки. {.task_text}

Что вообще в этом скрипте происходит? На первой строчке создается `matrix` — список элементов. Внутри цикла `for` объект `matrix` заполняется элементами-списками (то есть становится списком списков — матрицей 5x5). Элементы внутри вложенных списков заполняются целочисленными значениями. {.task_text}
```python {.task_source #python_chapter_0010_task_0040}
matrix = list()

for i in range(0, 5)
    matrix.append(list())
    for j in range(0, 5)
        matrix[i].append(i * j)

print(matrix)
```
```python {.task_hint}
Перед вложенным for'ом стоит табуляция, а перед обновлением элемента матрицы - пробелы. Пропущены двоеточия в объявлениях циклов.
```

{.paragraph}

## Сильные и слабые стороны
За что питон любят:
+ **Простота.** Питон быстро учится, код на нем легко читается. Главное — не растеряться с пробелами.
+ **Лаконичность.** За счет своей высокоуровневости питон не такой многословный как C++ или Java.
+ **Богатство библиотек** — стандартных и опенсорсных. Модули для веба, GUI, дата сайенса, машинного обучения и всего на свете.
+ **Высокая скорость разработки** как следствие перечисленных пунктов. Поэтому питон столь любим бизнесом: новые сервисы и фичи на нем разлетаются по продакшен-серверам как горячие пирожки.
+ **Интроспекция и рефлексия.** Интроспекция — возможность в рантайме для любого объекта выяснить его тип, список методов и полей, родительские классы и прочие ценные свойства. Рефлексия — возможность исполняемого кода не только получать, но и модифицировать собственную структуру и поведение. 
+ **Интерактивный режим** запуска интерпретатора, полезный для быстрой проверки небольших фрагментов кода, валидации идей, изучения языка. 
{.paragraph}

За что питон ругают:
- **Низкое быстродействие.** Следствие интерпретируемости и высокоуровневости. Исполнение кода обеспечивает виртуальная машина, и при каждом запуске скрипта интерптератор парсит код и строит AST-дерево. Эту проблему можно сгладить: сохранять промежуточный байт-код в специальных файлах, чтобы не генерировать его заново при каждом перезапуске. 
- **GIL** (global interpreter lock). Интерпретатор питона устроен так, что он запрещает выполнять несколько потоков одновременно. Процессы — пожалуйста. Потоки — нет. Это не шутка. Истинной параллельности потоков в питоне нет, потому что при выполнении кода интерпретатор оперирует потоко-небезопасными переменными. Чтобы гарантировать сохранность этих переменных, каждый поток интерпретатора вынужден захватывать и отпускать GIL.
- **Зависимость от системных библиотек.** При установке питон-приложения на целевую машину придется разбираться с настройкой виртуального окружения (venv), изолирующего версии библиотек. С другой стороны, сама возможность настройки виртуального окружения для бесконфликтного существования нескольких версий библиотек очень полезна. В каких-то случаях она даже позволяет отказаться от изоляции сервисов путем контейнеризации.
- **Ряд архитектурных решений,** вызывающих недоумение у разработчиков — выходцев из других языков программирования. Мы будем разбирать их в следующих главах. А пока предупредим, что в питоне нет константности (ключевого слова `const` или чего-то похожего), а интерпретатор не блокирует доступ ко внутренним полям класса и оставляет это на совести разработчика.

{.paragraph}

## Реализации питона: интерпретаторы
CPython — самый распространенный интерпретатор питона. Он идет в комплекте большинства Linux-дистрибутивов и без струда ставится почти на любые платформы. CPython написан преимущественно на C и его исходный код [выложен в опенсорс.](https://github.com/python/cpython) 

Конечно, есть и другие интерпретаторы. Самые известные:
- написанный на C# IronPython, позволяющий оперировать типами .NET.
- Jython — реализация питона на Java, в ней доступны классы Java.

Мы будем работать с CPython: это реализация языка, подразумеваемая по умолчанию, когда речь заходит про питон.

{.paragraph}

## Версии питона
Последняя мажорная версия — python 3. 3.11.4 — минорный релиз, вышедший в июне 2023 года. Его мы и будем рассматривать. 

Питон развивается уже больше тридцати лет. За это время самой масштабной поломкой обратной совместимости между версиями был переход с python 2 на 3. В питоне 3 был исправлен ряд недостатков архитектуры языка. Событие позитивное, но есть и обратная сторона. Чтобы мигрировать на новую версию, разработчикам пришлось переписывать тонны кода в уже существующих проектах.

Сейчас версия 2 официально не поддерживается. Автор языка Гвидо ван Россум уверяет, что при выходе python 4 повторения истории с поломкой совместимости не случится. Благо, серьезными уязвимостями язык больше не страдает.

Одним из отличий версии 3 от 2 является правило целочисленного деления. В питоне 2 результат деления целых чисел — также целое. В питоне 3 — вещественное, а для целочисленного деления вместо одной косой черты используется двойная: `//`.

Но самое заметное отличие — это отказ от оператора `print` для вывода текста в консоль. В питоне 3 он заменен на функцию `print()`.

{.paragraph}

Перепишите этот код с питона 2 на 3 так, чтобы целочисленное деление осталось целочисленным. {.task_text}
```python {.task_source #python_chapter_0010_task_0050}
x = 3/2
print x
```
```python {.task_hint}
Для целочисленного деления используйте оператор '//' вместо '/', для вывода в консоль - функцию 'print()' вместо оператора 'print'.
```

{.paragraph}

И последнее отличие, о котором стоит упомянуть: работа со строками. В питоне 2 было определено два строковых типа: `str` и `unicode`. В питоне 3 остался только `str`, зато он может содержать любые юникодные символы. Для обычных байтовых последовательностей используется тип `bytes`.

{.paragraph}

## Как и кем разрабатывается питон
Развитием языка занимается некоммерческая организация [Python Software Foundation](https://www.python.org/psf/). Новые фичи и изменения синтаксиса вводятся через PEP (Python Enhancement Proposal). PEP — это документ, который может составить и отправить на обсуждение любой желающий.  

[PEP8](https://peps.python.org/pep-0008/) — официальное руководство по написанию кода на питоне. Ему уже больше 10 лет! Рекомендации PEP8 соблюдает огромное количество опенсорсных и проприетарных проектов. Это де-факто стандарт индустрии по части кодстайла и лучших практик. Для приведения к нему своего кода можно воспользоваться форматтерами и линтерами: black, Pylint и другими.

Кстати, рекомендованная в PEP8 максимальная длина строки — 79 символов.

{.paragraph}

## Питон — это летающий цирк!
Питон назван не в честь змеи. Автор языка Гвидо ван Россум использовал отсылку к шоу "Летающий цирк Монти Пайтона". Того самого, где про Министерство дурацких походок.

{.paragraph}

...Поэтому единственное, что осталось сделать перед началом разработки на питоне — вывести в консоль "Hello Monty Python's Flying Circus!": {.task_text}
```python {.task_source #python_chapter_0010_task_0060}
```
```python {.task_hint}
print("Hello Monty Python's Flying Circus!")
```

{.paragraph}

![Летающий цирк Монти Пайтона](https://m.media-amazon.com/images/M/MV5BOTFmYTc3ZWEtNTYxNi00OTA4LTk2NjEtNTI2MTJlNzkyMDdlXkEyXkFqcGdeQWpybA@@._V1_.jpg){.illustration}

{.paragraph}

## Резюмируем
- Питон — интерпретируемый, а не компилируемый язык.
- В нем поддерживаются ООП и функциональное программирование.
- Типизация неявная, динамическая, строгая.
- Любая переменная — это ссылка на объект.
- Управление памятью — с помощью подсчета ссылок и сборщика мусора.
- Есть интроспекция и рефлексия.
- Один из главных недостатков питона — GIL.
- CPython — самый распространенный интерпретатор.
- Актуальная версия языка — 3.
- PEP — документы, в которых описываются изменения языка.
- PEP8 содержит рекомендации по кодстайлу и лучшие практики.

{.paragraph}
